
<!DOCTYPE HTML>
<html lang="us-en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Etcd Learner Design · etcd 英文文档</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="Mitigating common challenges with membership reconfiguration">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-solarizedlight.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="glossary.html" />
    
    
    <link rel="prev" href="design-client.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://docs.khs1994.com" target="_blank" class="custom-link">Home</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" >
            
                <span>
            
                    
                    Benchmarks
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="../benchmarks/_index.html">
            
                <a href="../benchmarks/_index.html">
            
                    
                    Benchmarks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="../benchmarks/etcd-2-1-0-alpha-benchmarks.html">
            
                <a href="../benchmarks/etcd-2-1-0-alpha-benchmarks.html">
            
                    
                    Benchmarking etcd v2.1.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3" data-path="../benchmarks/etcd-2-2-0-benchmarks.html">
            
                <a href="../benchmarks/etcd-2-2-0-benchmarks.html">
            
                    
                    Benchmarking etcd v2.2.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4" data-path="../benchmarks/etcd-2-2-0-rc-benchmarks.html">
            
                <a href="../benchmarks/etcd-2-2-0-rc-benchmarks.html">
            
                    
                    Benchmarking etcd v2.2.0-rc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.5" data-path="../benchmarks/etcd-2-2-0-rc-memory-benchmarks.html">
            
                <a href="../benchmarks/etcd-2-2-0-rc-memory-benchmarks.html">
            
                    
                    Benchmarking etcd v2.2.0-rc-memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6" data-path="../benchmarks/etcd-3-demo-benchmarks.html">
            
                <a href="../benchmarks/etcd-3-demo-benchmarks.html">
            
                    
                    Benchmarking Etcd V 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7" data-path="../benchmarks/etcd-3-watch-memory-benchmark.html">
            
                <a href="../benchmarks/etcd-3-watch-memory-benchmark.html">
            
                    
                    Watch Memory Usage Benchmark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.8" data-path="../benchmarks/etcd-storage-memory-benchmark.html">
            
                <a href="../benchmarks/etcd-storage-memory-benchmark.html">
            
                    
                    Storage Memory Usage Benchmark
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Dev Guide
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../dev-guide/_index.html">
            
                <a href="../dev-guide/_index.html">
            
                    
                    Developer Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../dev-guide/api_concurrency_reference_v3.html">
            
                <a href="../dev-guide/api_concurrency_reference_v3.html">
            
                    
                    API Reference Concurrency
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../dev-guide/api_grpc_gateway.html">
            
                <a href="../dev-guide/api_grpc_gateway.html">
            
                    
                    Why G RPC Gateway
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../dev-guide/api_reference_v3.html">
            
                <a href="../dev-guide/api_reference_v3.html">
            
                    
                    API Reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../dev-guide/discovery_protocol.html">
            
                <a href="../dev-guide/discovery_protocol.html">
            
                    
                    Discovery Service Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../dev-guide/features.html">
            
                <a href="../dev-guide/features.html">
            
                    
                    Etcd Features
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../dev-guide/grpc_naming.html">
            
                <a href="../dev-guide/grpc_naming.html">
            
                    
                    G RPC Naming And Discovery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../dev-guide/interacting_v3.html">
            
                <a href="../dev-guide/interacting_v3.html">
            
                    
                    Interacting With Etcd
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../dev-guide/limit.html">
            
                <a href="../dev-guide/limit.html">
            
                    
                    System Limits
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="../dev-guide/local_cluster.html">
            
                <a href="../dev-guide/local_cluster.html">
            
                    
                    Set Up A Local Cluster
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Dev Internal
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../dev-internal/discovery_protocol.html">
            
                <a href="../dev-internal/discovery_protocol.html">
            
                    
                    Discovery Service Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../dev-internal/logging.html">
            
                <a href="../dev-internal/logging.html">
            
                    
                    Logging Conventions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../dev-internal/modules.html">
            
                <a href="../dev-internal/modules.html">
            
                    
                    Golang Modules
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Downgrades
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../downgrades/_index.html">
            
                <a href="../downgrades/_index.html">
            
                    
                    Downgrading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../downgrades/downgrade_3_5.html">
            
                <a href="../downgrades/downgrade_3_5.html">
            
                    
                    Downgrade etcd from 3.5 to 3.4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../downgrades/downgrading-etcd.html">
            
                <a href="../downgrades/downgrading-etcd.html">
            
                    
                    Downgrading Etcd Clusters And Applications
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    Learning
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="_index.html">
            
                <a href="_index.html">
            
                    
                    Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="api_guarantees.html">
            
                <a href="api_guarantees.html">
            
                    
                    Etcd API Guarantees
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.3" data-path="api.html">
            
                <a href="api.html">
            
                    
                    Etcd API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="data_model.html">
            
                <a href="data_model.html">
            
                    
                    Data Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="design-auth-v3.html">
            
                <a href="design-auth-v3.html">
            
                    
                    Etcd V 3 Authentication Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="design-client.html">
            
                <a href="design-client.html">
            
                    
                    Etcd Client Design
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.7" data-path="design-learner.html">
            
                <a href="design-learner.html">
            
                    
                    Etcd Learner Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="glossary.html">
            
                <a href="glossary.html">
            
                    
                    Glossary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="persistent-storage-files.html">
            
                <a href="persistent-storage-files.html">
            
                    
                    Etcd Persistent Storage Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="why.html">
            
                <a href="why.html">
            
                    
                    Etcd Versus Other Key Value Stores
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Op Guide
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" >
            
                <span>
            
                    
                    Authentication
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.1" data-path="../op-guide/authentication/_index.html">
            
                <a href="../op-guide/authentication/_index.html">
            
                    
                    Authentication Guides
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.2" data-path="../op-guide/authentication/authentication.html">
            
                <a href="../op-guide/authentication/authentication.html">
            
                    
                    Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.3" data-path="../op-guide/authentication/rbac.html">
            
                <a href="../op-guide/authentication/rbac.html">
            
                    
                    Role Based Access Control
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../op-guide/_index.html">
            
                <a href="../op-guide/_index.html">
            
                    
                    Operations Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../op-guide/clustering.html">
            
                <a href="../op-guide/clustering.html">
            
                    
                    Clustering Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../op-guide/configuration.html">
            
                <a href="../op-guide/configuration.html">
            
                    
                    Configuration Options
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../op-guide/container.html">
            
                <a href="../op-guide/container.html">
            
                    
                    Run Etcd Clusters Inside Containers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../op-guide/data_corruption.html">
            
                <a href="../op-guide/data_corruption.html">
            
                    
                    Data Corruption
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../op-guide/failures.html">
            
                <a href="../op-guide/failures.html">
            
                    
                    Failure Modes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../op-guide/gateway.html">
            
                <a href="../op-guide/gateway.html">
            
                    
                    Etcd Gateway
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../op-guide/grpc_proxy.html">
            
                <a href="../op-guide/grpc_proxy.html">
            
                    
                    G RPC Proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../op-guide/hardware.html">
            
                <a href="../op-guide/hardware.html">
            
                    
                    Hardware Recommendations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="../op-guide/kubernetes.html">
            
                <a href="../op-guide/kubernetes.html">
            
                    
                    Run Etcd Clusters As A Kubernetes Stateful Set
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="../op-guide/maintenance.html">
            
                <a href="../op-guide/maintenance.html">
            
                    
                    Maintenance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="../op-guide/monitoring.html">
            
                <a href="../op-guide/monitoring.html">
            
                    
                    Monitoring Etcd
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="../op-guide/performance.html">
            
                <a href="../op-guide/performance.html">
            
                    
                    Performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="../op-guide/recovery.html">
            
                <a href="../op-guide/recovery.html">
            
                    
                    Disaster Recovery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="../op-guide/runtime-configuration.html">
            
                <a href="../op-guide/runtime-configuration.html">
            
                    
                    Runtime Reconfiguration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.17" data-path="../op-guide/runtime-reconf-design.html">
            
                <a href="../op-guide/runtime-reconf-design.html">
            
                    
                    Design Of Runtime Reconfiguration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.18" data-path="../op-guide/security.html">
            
                <a href="../op-guide/security.html">
            
                    
                    Transport Security Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.19" data-path="../op-guide/supported-platform.html">
            
                <a href="../op-guide/supported-platform.html">
            
                    
                    Supported Platforms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.20" data-path="../op-guide/versioning.html">
            
                <a href="../op-guide/versioning.html">
            
                    
                    Versioning
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Triage
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../triage/_index.html">
            
                <a href="../triage/_index.html">
            
                    
                    Triage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../triage/issues.html">
            
                <a href="../triage/issues.html">
            
                    
                    Issue Triage Guidelines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../triage/PRs.html">
            
                <a href="../triage/PRs.html">
            
                    
                    PR Management
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    Tutorials
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../tutorials/_index.html">
            
                <a href="../tutorials/_index.html">
            
                    
                    Tutorials
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../tutorials/how-to-check-cluster-status.html">
            
                <a href="../tutorials/how-to-check-cluster-status.html">
            
                    
                    How To Check Cluster Status
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../tutorials/how-to-conduct-elections.html">
            
                <a href="../tutorials/how-to-conduct-elections.html">
            
                    
                    How To Conduct Leader Election In Etcd Cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../tutorials/how-to-create-lease.html">
            
                <a href="../tutorials/how-to-create-lease.html">
            
                    
                    How To Create Lease
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../tutorials/how-to-create-locks.html">
            
                <a href="../tutorials/how-to-create-locks.html">
            
                    
                    How To Create Locks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../tutorials/how-to-deal-with-membership.html">
            
                <a href="../tutorials/how-to-deal-with-membership.html">
            
                    
                    How To Add And Remove Members
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="../tutorials/how-to-delete-keys.html">
            
                <a href="../tutorials/how-to-delete-keys.html">
            
                    
                    How To Delete Keys
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.8" data-path="../tutorials/how-to-get-key-by-prefix.html">
            
                <a href="../tutorials/how-to-get-key-by-prefix.html">
            
                    
                    How To Get Keys By Prefix
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.9" data-path="../tutorials/how-to-migrate.html">
            
                <a href="../tutorials/how-to-migrate.html">
            
                    
                    How To Migrate Etcd From V 2 To V 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.10" data-path="../tutorials/how-to-save-database.html">
            
                <a href="../tutorials/how-to-save-database.html">
            
                    
                    How To Save The Database
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.11" data-path="../tutorials/how-to-setup-cluster.html">
            
                <a href="../tutorials/how-to-setup-cluster.html">
            
                    
                    How To Set Up A Demo Etcd Cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.12" data-path="../tutorials/how-to-transactional-write.html">
            
                <a href="../tutorials/how-to-transactional-write.html">
            
                    
                    How To Make Multiple Writes In A Transaction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.13" data-path="../tutorials/how-to-watch-keys.html">
            
                <a href="../tutorials/how-to-watch-keys.html">
            
                    
                    How To Watch Keys
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.14" data-path="../tutorials/reading-from-etcd.html">
            
                <a href="../tutorials/reading-from-etcd.html">
            
                    
                    Reading From Etcd
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.15" data-path="../tutorials/writing-to-etcd.html">
            
                <a href="../tutorials/writing-to-etcd.html">
            
                    
                    Writing To Etcd
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    Upgrades
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../upgrades/_index.html">
            
                <a href="../upgrades/_index.html">
            
                    
                    Upgrading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../upgrades/upgrade_3_0.html">
            
                <a href="../upgrades/upgrade_3_0.html">
            
                    
                    Upgrade etcd from 2.3 to 3.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../upgrades/upgrade_3_1.html">
            
                <a href="../upgrades/upgrade_3_1.html">
            
                    
                    Upgrade etcd from 3.0 to 3.1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../upgrades/upgrade_3_2.html">
            
                <a href="../upgrades/upgrade_3_2.html">
            
                    
                    Upgrade etcd from 3.1 to 3.2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../upgrades/upgrade_3_3.html">
            
                <a href="../upgrades/upgrade_3_3.html">
            
                    
                    Upgrade etcd from 3.2 to 3.3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../upgrades/upgrade_3_4.html">
            
                <a href="../upgrades/upgrade_3_4.html">
            
                    
                    Upgrade etcd from 3.3 to 3.4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../upgrades/upgrade_3_5.html">
            
                <a href="../upgrades/upgrade_3_5.html">
            
                    
                    Upgrade etcd from 3.4 to 3.5
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="../upgrades/upgrading-etcd.html">
            
                <a href="../upgrades/upgrading-etcd.html">
            
                    
                    Upgrading Etcd Clusters And Applications
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../demo.html">
            
                <a href="../demo.html">
            
                    
                    Demo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../faq.html">
            
                <a href="../faq.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../install.html">
            
                <a href="../install.html">
            
                    
                    Install
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../integrations.html">
            
                <a href="../integrations.html">
            
                    
                    Libraries And Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../metrics.html">
            
                <a href="../metrics.html">
            
                    
                    Metrics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../quickstart.html">
            
                <a href="../quickstart.html">
            
                    
                    Quickstart
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="../">
            
                <a href="../">
            
                    
                    v3.5 docs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="../reporting_bugs.html">
            
                <a href="../reporting_bugs.html">
            
                    
                    Reporting Bugs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="../tuning.html">
            
                <a href="../tuning.html">
            
                    
                    Tuning
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Etcd Learner Design</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="etcd-learner">etcd Learner</h1>
<p><em>Gyuho Lee (github.com/gyuho, Amazon Web Services, Inc.), Joe Betz (github.com/jpbetz, Google Inc.)</em></p>
<h1 id="background">Background</h1>
<p>Membership reconfiguration has been one of the biggest operational challenges. Let&#x2019;s review common challenges.</p>
<h3 id="1-new-cluster-member-overloads-leader">1. New Cluster member overloads Leader</h3>
<p>A newly joined etcd member starts with no data, thus demanding more updates from leader until it catches up with leader&#x2019;s logs. Then leader&#x2019;s network is more likely to be overloaded, blocking or dropping leader heartbeats to followers. In such case, a follower may election-timeout to start a new leader election. That is, a cluster with a new member is more vulnerable to leader election. Both leader election and the subsequent update propagation to the new member are prone to causing periods of cluster unavailability (see <em>Figure 1</em>).</p>
<p><img src="../img/server-learner-figure-01.png" alt="server-learner-figure-01"></p>
<h3 id="2-network-partitions-scenarios">2. Network Partitions scenarios</h3>
<p>What if network partition happens? It depends on leader partition. If the leader still maintains the active quorum, the cluster would continue to operate (see <em>Figure 2</em>).</p>
<p><img src="../img/server-learner-figure-02.png" alt="server-learner-figure-02"></p>
<h4 id="21-leader-isolation">2.1 Leader isolation</h4>
<p>What if the leader becomes isolated from the rest of the cluster? Leader monitors progress of each follower. When leader loses connectivity from the quorum, it reverts back to follower which will affect the cluster availability (see <em>Figure 3</em>).</p>
<p><img src="../img/server-learner-figure-03.png" alt="server-learner-figure-03"></p>
<p>When a new node is added to 3 node cluster, the cluster size becomes 4 and the quorum size becomes 3. What if a new node had joined the cluster, and then network partition happens? It depends on which partition the new member gets located after partition.</p>
<h4 id="22-cluster-split-31">2.2 Cluster Split 3+1</h4>
<p>If the new node happens to be located in the same partition as leader&#x2019;s, the leader still maintains the active quorum of 3. No leadership election happens, and no cluster availability gets affected (see <em>Figure 4</em>).</p>
<p><img src="../img/server-learner-figure-04.png" alt="server-learner-figure-04"></p>
<h4 id="23-cluster-split-22">2.3 Cluster Split 2+2</h4>
<p>If the cluster is 2-and-2 partitioned, then neither of partition maintains the quorum of 3. In this case, leadership election happens (see <em>Figure 5</em>).</p>
<p><img src="../img/server-learner-figure-05.png" alt="server-learner-figure-05"></p>
<h4 id="24-quorum-lost">2.4 Quorum Lost</h4>
<p>What if network partition happens first, and then a new member gets added? A partitioned 3-node cluster already has one disconnected follower. When a new member is added, the quorum changes from 2 to 3. Now, this cluster has only 2 active nodes out 4, thus losing quorum and starting a new leadership election (see <em>Figure 6</em>).</p>
<p><img src="../img/server-learner-figure-06.png" alt="server-learner-figure-06"></p>
<p>Since member add operation can change the size of quorum, it is always recommended to &#x201C;member remove&#x201D; first to replace an unhealthy node.</p>
<p>Adding a new member to a 1-node cluster changes the quorum size to 2, immediately causing a leader election when the previous leader finds out quorum is not active. This is because &#x201C;member add&#x201D; operation is a 2-step process where user needs to apply &#x201C;member add&#x201D; command first, and then starts the new node process (see <em>Figure 7</em>).</p>
<p><img src="../img/server-learner-figure-07.png" alt="server-learner-figure-07"></p>
<h3 id="3-cluster-misconfigurations">3. Cluster Misconfigurations</h3>
<p>An even worse case is when an added member is misconfigured. Membership reconfiguration is a two-step process: &#x201C;etcdctl member add&#x201D; and starting an etcd server process with the given peer URL. That is, &#x201C;member add&#x201D; command is applied regardless of URL, even when the URL value is invalid. If the first step is applied with invalid URLs, the second step cannot even start the new etcd. Once the cluster loses quorum, there is no way to revert the membership change (see <em>Figure 8</em>).</p>
<p><img src="../img/server-learner-figure-08.png" alt="server-learner-figure-08"></p>
<p>Same applies to a multi-node cluster. For example, the cluster has two members down (one is failed, the other is misconfigured) and two members up, but now it requires at least 3 votes to change the cluster membership (see <em>Figure 9</em>).</p>
<p><img src="../img/server-learner-figure-09.png" alt="server-learner-figure-09"></p>
<p>As seen above, a simple misconfiguration can fail the whole cluster into an inoperative state. In such case, an operator need manually recreate the cluster with <code>etcd --force-new-cluster</code> flag. As etcd has become a mission-critical service for Kubernetes, even the slightest outage may have significant impact on users. What can we better to make etcd such operations easier? Among other things, leader election is most critical to cluster availability: Can we make membership reconfiguration less disruptive by not changing the size of quorum? Can a new node be idle, only requesting the minimum updates from leader, until it catches up? Can membership misconfiguration be always reversible and handled in a more secure way (wrong member add command run should never fail the cluster)? Should an user worry about network topology when adding a new member? Can member add API work regardless of the location of nodes and ongoing network partitions?</p>
<h1 id="raft-learner">Raft Learner</h1>
<p>In order to mitigate such availability gaps in the previous section, <a href="https://github.com/ongardie/dissertation/blob/master/stanford.pdf" target="_blank">Raft &#xA7;4.2.1</a> introduces a new node state &#x201C;Learner&#x201D;, which joins the cluster as a <strong>non-voting member</strong> until it catches up to leader&#x2019;s logs.</p>
<h2 id="features-in-v34">Features in v3.4</h2>
<p>An operator should do the minimum amount of work possible to add a new learner node. <code>member add --learner</code> command to add a new learner, which joins cluster as a non-voting member but still receives all data from leader (see <em>Figure 10</em>).</p>
<p><img src="../img/server-learner-figure-10.png" alt="server-learner-figure-10"></p>
<p>When a learner has caught up with leader&#x2019;s progress, the learner can be promoted to a voting member using <code>member promote</code> API, which then counts towards the quorum (see <em>Figure 11</em>).</p>
<p><img src="../img/server-learner-figure-11.png" alt="server-learner-figure-11"></p>
<p>etcd server validates promote request to ensure its operational safety. Only after its log has caught up to leader&#x2019;s can learner be promoted to a voting member (see <em>Figure 12</em>).</p>
<p><img src="../img/server-learner-figure-12.png" alt="server-learner-figure-12"></p>
<p>Learner only serves as a standby node until promoted: Leadership cannot be transferred to learner. Learner rejects client reads and writes (client balancer should not route requests to learner). Which means learner does not need issue Read Index requests to leader. Such limitation simplifies the initial learner implementation in v3.4 release (see <em>Figure 13</em>).</p>
<p><img src="../img/server-learner-figure-13.png" alt="server-learner-figure-13"></p>
<p>In addition, etcd limits the total number of learners that a cluster can have, and avoids overloading the leader with log replication. Learner never promotes itself. While etcd provides learner status information and safety checks, cluster operator must make the final decision whether to promote learner or not.</p>
<h2 id="proposed-features-for-future-releases">Proposed features for future releases</h2>
<p><em>Make learner state only and default</em>: Defaulting a new member state to learner will greatly improve membership reconfiguration safety, because learner does not change the size of quorum. Misconfiguration will always be reversible without losing the quorum.</p>
<p><em>Make voting-member promotion fully automatic</em>: Once a learner catches up to leader&#x2019;s logs, a cluster can automatically promote the learner. etcd requires certain thresholds to be defined by the user, and once the requirements are satisfied, learner promotes itself to a voting member. From a user&#x2019;s perspective, &#x201C;member add&#x201D; command would work the same way as today but with greater safety provided by learner feature.</p>
<p><em>Make learner standby failover node</em>: A learner joins as a standby node, and gets automatically promoted when the cluster availability is affected.</p>
<p><em>Make learner read-only</em>: A learner can serve as a read-only node that never gets promoted. In a weak consistency mode, learner only receives data from leader and never process writes. Serving reads locally without consensus overhead would greatly decrease the workloads to leader but may serve stale data. In a strong consistency mode, learner requests read index from leader to serve latest data, but still rejects writes.</p>
<h1 id="learner-vs-mirror-maker">Learner vs. Mirror Maker</h1>
<p>etcd implements &#x201C;mirror maker&#x201D; using watch API to continuously relay key creates and updates to a separate cluster. Mirroring usually has low latency overhead once it completes initial synchronization. Learner and mirroring overlap in that both can be used to replicate existing data for read-only. However, mirroring does not guarantee linearizability. During network disconnects, previous key-values might have been discarded, and clients are expected to verify watch responses for correct ordering. Thus, there is no ordering guarantee in mirror. Use mirror for minimum latency (e.g. cross data center) at the costs of consistency. Use learner to retain all historical data and its ordering.</p>
<h1 id="appendix-learner-implementation-in-v34">Appendix: Learner Implementation in v3.4</h1>
<p><em>Expose &quot;Learner&quot; node type to &quot;MemberAdd&quot; API.</em></p>
<p>etcd client adds a flag to &#x201C;MemberAdd&#x201D; API for learner node. And etcd server handler applies membership change entry with <code>pb.ConfChangeAddLearnerNode</code> type. Once the command has been applied, a server joins the cluster with <code>etcd --initial-cluster-state=existing</code> flag. This learner node can neither vote nor count as quorum.</p>
<p>etcd server must not transfer leadership to learner, since it may still lag behind and does not count as quorum. etcd server limits the number of learners that cluster can have to one: the more learners we have, the more data the leader has to propagate. Clients may talk to learner node, but learner rejects all requests other than serializable read and member status API. This is for simplicity of initial implementation. In the future, learner can be extended as a read-only server that continuously mirrors cluster data. Client balancer must provide helper function to exclude learner node endpoint. Otherwise, request sent to learner may fail. Client sync member call should factor into learner node type. So should client endpoints update call.</p>
<p><code>MemberList</code> and <code>MemberStatus</code> responses should indicate which node is learner.</p>
<p><em>Add &quot;MemberPromote&quot; API.</em></p>
<p>Internally in Raft, second <code>MemberAdd</code> call to learner node promotes it to a voting member. Leader maintains the progress of each follower and learner. If learner has not completed its snapshot message, reject promote request. Only accept promote request if and only if: The learner node is in a healthy state. The learner is in sync with leader or the delta is within the threshold (e.g. the number of entries to replicate to learner is less than 1/10 of snapshot count, which means it is less likely that even after promotion leader would not need send snapshot to the learner). All these logic are hard-coded in <code>etcdserver</code> package and not configurable.</p>
<h1 id="reference">Reference</h1>
<ul>
<li>Original github issue: <a href="https://github.com/etcd-io/etcd/issues/9161" target="_blank">etcd#9161</a></li>
<li>Use case: <a href="https://github.com/etcd-io/etcd/issues/3715" target="_blank">etcd#3715</a></li>
<li>Use case: <a href="https://github.com/etcd-io/etcd/issues/8888" target="_blank">etcd#8888</a></li>
<li>Use case: <a href="https://github.com/etcd-io/etcd/issues/10114" target="_blank">etcd#10114</a></li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="design-client.html" class="navigation navigation-prev " aria-label="Previous page: Etcd Client Design">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="glossary.html" class="navigation navigation-next " aria-label="Next page: Glossary">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Etcd Learner Design","weight":2375,"description":"Mitigating common challenges with membership reconfiguration","level":"1.5.7","depth":2,"next":{"title":"Glossary","level":"1.5.8","depth":2,"path":"learning/glossary.md","ref":"learning/glossary.md","articles":[]},"previous":{"title":"Etcd Client Design","level":"1.5.6","depth":2,"path":"learning/design-client.md","ref":"learning/design-client.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","-highlight","-livereload","prism"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-solarizedlight.css"]},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"etcd 英文文档","language":"us-en","links":{"sidebar":{"Home":"https://docs.khs1994.com"}},"gitbook":"*"},"file":{"path":"learning/design-learner.md","mtime":"2024-09-13T01:00:24.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2024-09-13T01:01:05.458Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

