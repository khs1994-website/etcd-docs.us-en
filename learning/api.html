
<!DOCTYPE HTML>
<html lang="us-en" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Etcd API · etcd 英文文档</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="etcd API central design overview">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="../gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-prism/prism-solarizedlight.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="../gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="../gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="../gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="data_model.html" />
    
    
    <link rel="prev" href="api_guarantees.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    
    
        
        <li>
            <a href="https://docs.khs1994.com" target="_blank" class="custom-link">Home</a>
        </li>
    
    

    
    <li class="divider"></li>
    

    
        
        
    
        <li class="chapter " data-level="1.1" >
            
                <span>
            
                    
                    Benchmarks
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.1.1" data-path="../benchmarks/_index.html">
            
                <a href="../benchmarks/_index.html">
            
                    
                    Benchmarks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.2" data-path="../benchmarks/etcd-2-1-0-alpha-benchmarks.html">
            
                <a href="../benchmarks/etcd-2-1-0-alpha-benchmarks.html">
            
                    
                    Benchmarking etcd v2.1.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.3" data-path="../benchmarks/etcd-2-2-0-benchmarks.html">
            
                <a href="../benchmarks/etcd-2-2-0-benchmarks.html">
            
                    
                    Benchmarking etcd v2.2.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.4" data-path="../benchmarks/etcd-2-2-0-rc-benchmarks.html">
            
                <a href="../benchmarks/etcd-2-2-0-rc-benchmarks.html">
            
                    
                    Benchmarking etcd v2.2.0-rc
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.5" data-path="../benchmarks/etcd-2-2-0-rc-memory-benchmarks.html">
            
                <a href="../benchmarks/etcd-2-2-0-rc-memory-benchmarks.html">
            
                    
                    Benchmarking etcd v2.2.0-rc-memory
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.6" data-path="../benchmarks/etcd-3-demo-benchmarks.html">
            
                <a href="../benchmarks/etcd-3-demo-benchmarks.html">
            
                    
                    Benchmarking Etcd V 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.7" data-path="../benchmarks/etcd-3-watch-memory-benchmark.html">
            
                <a href="../benchmarks/etcd-3-watch-memory-benchmark.html">
            
                    
                    Watch Memory Usage Benchmark
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.1.8" data-path="../benchmarks/etcd-storage-memory-benchmark.html">
            
                <a href="../benchmarks/etcd-storage-memory-benchmark.html">
            
                    
                    Storage Memory Usage Benchmark
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.2" >
            
                <span>
            
                    
                    Dev Guide
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.2.1" data-path="../dev-guide/_index.html">
            
                <a href="../dev-guide/_index.html">
            
                    
                    Developer Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.2" data-path="../dev-guide/api_concurrency_reference_v3.html">
            
                <a href="../dev-guide/api_concurrency_reference_v3.html">
            
                    
                    API Reference Concurrency
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.3" data-path="../dev-guide/api_grpc_gateway.html">
            
                <a href="../dev-guide/api_grpc_gateway.html">
            
                    
                    Why G RPC Gateway
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.4" data-path="../dev-guide/api_reference_v3.html">
            
                <a href="../dev-guide/api_reference_v3.html">
            
                    
                    API Reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.5" data-path="../dev-guide/discovery_protocol.html">
            
                <a href="../dev-guide/discovery_protocol.html">
            
                    
                    Discovery Service Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.6" data-path="../dev-guide/features.html">
            
                <a href="../dev-guide/features.html">
            
                    
                    Etcd Features
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.7" data-path="../dev-guide/grpc_naming.html">
            
                <a href="../dev-guide/grpc_naming.html">
            
                    
                    G RPC Naming And Discovery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.8" data-path="../dev-guide/interacting_v3.html">
            
                <a href="../dev-guide/interacting_v3.html">
            
                    
                    Interacting With Etcd
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.9" data-path="../dev-guide/limit.html">
            
                <a href="../dev-guide/limit.html">
            
                    
                    System Limits
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2.10" data-path="../dev-guide/local_cluster.html">
            
                <a href="../dev-guide/local_cluster.html">
            
                    
                    Set Up A Local Cluster
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.3" >
            
                <span>
            
                    
                    Dev Internal
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.3.1" data-path="../dev-internal/discovery_protocol.html">
            
                <a href="../dev-internal/discovery_protocol.html">
            
                    
                    Discovery Service Protocol
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.2" data-path="../dev-internal/logging.html">
            
                <a href="../dev-internal/logging.html">
            
                    
                    Logging Conventions
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3.3" data-path="../dev-internal/modules.html">
            
                <a href="../dev-internal/modules.html">
            
                    
                    Golang Modules
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.4" >
            
                <span>
            
                    
                    Downgrades
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.4.1" data-path="../downgrades/_index.html">
            
                <a href="../downgrades/_index.html">
            
                    
                    Downgrading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.2" data-path="../downgrades/downgrade_3_5.html">
            
                <a href="../downgrades/downgrade_3_5.html">
            
                    
                    Downgrade etcd from 3.5 to 3.4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4.3" data-path="../downgrades/downgrading-etcd.html">
            
                <a href="../downgrades/downgrading-etcd.html">
            
                    
                    Downgrading Etcd Clusters And Applications
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.5" >
            
                <span>
            
                    
                    Learning
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.5.1" data-path="_index.html">
            
                <a href="_index.html">
            
                    
                    Learning
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="api_guarantees.html">
            
                <a href="api_guarantees.html">
            
                    
                    Etcd API Guarantees
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.5.3" data-path="api.html">
            
                <a href="api.html">
            
                    
                    Etcd API
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.4" data-path="data_model.html">
            
                <a href="data_model.html">
            
                    
                    Data Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.5" data-path="design-auth-v3.html">
            
                <a href="design-auth-v3.html">
            
                    
                    Etcd V 3 Authentication Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.6" data-path="design-client.html">
            
                <a href="design-client.html">
            
                    
                    Etcd Client Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.7" data-path="design-learner.html">
            
                <a href="design-learner.html">
            
                    
                    Etcd Learner Design
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.8" data-path="glossary.html">
            
                <a href="glossary.html">
            
                    
                    Glossary
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.9" data-path="persistent-storage-files.html">
            
                <a href="persistent-storage-files.html">
            
                    
                    Etcd Persistent Storage Files
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.10" data-path="why.html">
            
                <a href="why.html">
            
                    
                    Etcd Versus Other Key Value Stores
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" >
            
                <span>
            
                    
                    Op Guide
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1" >
            
                <span>
            
                    
                    Authentication
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.6.1.1" data-path="../op-guide/authentication/_index.html">
            
                <a href="../op-guide/authentication/_index.html">
            
                    
                    Authentication Guides
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.2" data-path="../op-guide/authentication/authentication.html">
            
                <a href="../op-guide/authentication/authentication.html">
            
                    
                    Authentication
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.1.3" data-path="../op-guide/authentication/rbac.html">
            
                <a href="../op-guide/authentication/rbac.html">
            
                    
                    Role Based Access Control
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6.2" data-path="../op-guide/_index.html">
            
                <a href="../op-guide/_index.html">
            
                    
                    Operations Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.3" data-path="../op-guide/clustering.html">
            
                <a href="../op-guide/clustering.html">
            
                    
                    Clustering Guide
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.4" data-path="../op-guide/configuration.html">
            
                <a href="../op-guide/configuration.html">
            
                    
                    Configuration Options
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.5" data-path="../op-guide/container.html">
            
                <a href="../op-guide/container.html">
            
                    
                    Run Etcd Clusters Inside Containers
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.6" data-path="../op-guide/data_corruption.html">
            
                <a href="../op-guide/data_corruption.html">
            
                    
                    Data Corruption
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.7" data-path="../op-guide/failures.html">
            
                <a href="../op-guide/failures.html">
            
                    
                    Failure Modes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.8" data-path="../op-guide/gateway.html">
            
                <a href="../op-guide/gateway.html">
            
                    
                    Etcd Gateway
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.9" data-path="../op-guide/grpc_proxy.html">
            
                <a href="../op-guide/grpc_proxy.html">
            
                    
                    G RPC Proxy
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.10" data-path="../op-guide/hardware.html">
            
                <a href="../op-guide/hardware.html">
            
                    
                    Hardware Recommendations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.11" data-path="../op-guide/kubernetes.html">
            
                <a href="../op-guide/kubernetes.html">
            
                    
                    Run Etcd Clusters As A Kubernetes Stateful Set
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.12" data-path="../op-guide/maintenance.html">
            
                <a href="../op-guide/maintenance.html">
            
                    
                    Maintenance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.13" data-path="../op-guide/monitoring.html">
            
                <a href="../op-guide/monitoring.html">
            
                    
                    Monitoring Etcd
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.14" data-path="../op-guide/performance.html">
            
                <a href="../op-guide/performance.html">
            
                    
                    Performance
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.15" data-path="../op-guide/recovery.html">
            
                <a href="../op-guide/recovery.html">
            
                    
                    Disaster Recovery
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.16" data-path="../op-guide/runtime-configuration.html">
            
                <a href="../op-guide/runtime-configuration.html">
            
                    
                    Runtime Reconfiguration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.17" data-path="../op-guide/runtime-reconf-design.html">
            
                <a href="../op-guide/runtime-reconf-design.html">
            
                    
                    Design Of Runtime Reconfiguration
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.18" data-path="../op-guide/security.html">
            
                <a href="../op-guide/security.html">
            
                    
                    Transport Security Model
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.19" data-path="../op-guide/supported-platform.html">
            
                <a href="../op-guide/supported-platform.html">
            
                    
                    Supported Platforms
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6.20" data-path="../op-guide/versioning.html">
            
                <a href="../op-guide/versioning.html">
            
                    
                    Versioning
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.7" >
            
                <span>
            
                    
                    Triage
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.7.1" data-path="../triage/_index.html">
            
                <a href="../triage/_index.html">
            
                    
                    Triage
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.2" data-path="../triage/issues.html">
            
                <a href="../triage/issues.html">
            
                    
                    Issue Triage Guidelines
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7.3" data-path="../triage/PRs.html">
            
                <a href="../triage/PRs.html">
            
                    
                    PR Management
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.8" >
            
                <span>
            
                    
                    Tutorials
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.8.1" data-path="../tutorials/_index.html">
            
                <a href="../tutorials/_index.html">
            
                    
                    Tutorials
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.2" data-path="../tutorials/how-to-check-cluster-status.html">
            
                <a href="../tutorials/how-to-check-cluster-status.html">
            
                    
                    How To Check Cluster Status
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.3" data-path="../tutorials/how-to-conduct-elections.html">
            
                <a href="../tutorials/how-to-conduct-elections.html">
            
                    
                    How To Conduct Leader Election In Etcd Cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.4" data-path="../tutorials/how-to-create-lease.html">
            
                <a href="../tutorials/how-to-create-lease.html">
            
                    
                    How To Create Lease
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.5" data-path="../tutorials/how-to-create-locks.html">
            
                <a href="../tutorials/how-to-create-locks.html">
            
                    
                    How To Create Locks
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.6" data-path="../tutorials/how-to-deal-with-membership.html">
            
                <a href="../tutorials/how-to-deal-with-membership.html">
            
                    
                    How To Add And Remove Members
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.7" data-path="../tutorials/how-to-delete-keys.html">
            
                <a href="../tutorials/how-to-delete-keys.html">
            
                    
                    How To Delete Keys
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.8" data-path="../tutorials/how-to-get-key-by-prefix.html">
            
                <a href="../tutorials/how-to-get-key-by-prefix.html">
            
                    
                    How To Get Keys By Prefix
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.9" data-path="../tutorials/how-to-migrate.html">
            
                <a href="../tutorials/how-to-migrate.html">
            
                    
                    How To Migrate Etcd From V 2 To V 3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.10" data-path="../tutorials/how-to-save-database.html">
            
                <a href="../tutorials/how-to-save-database.html">
            
                    
                    How To Save The Database
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.11" data-path="../tutorials/how-to-setup-cluster.html">
            
                <a href="../tutorials/how-to-setup-cluster.html">
            
                    
                    How To Set Up A Demo Etcd Cluster
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.12" data-path="../tutorials/how-to-transactional-write.html">
            
                <a href="../tutorials/how-to-transactional-write.html">
            
                    
                    How To Make Multiple Writes In A Transaction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.13" data-path="../tutorials/how-to-watch-keys.html">
            
                <a href="../tutorials/how-to-watch-keys.html">
            
                    
                    How To Watch Keys
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.14" data-path="../tutorials/reading-from-etcd.html">
            
                <a href="../tutorials/reading-from-etcd.html">
            
                    
                    Reading From Etcd
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8.15" data-path="../tutorials/writing-to-etcd.html">
            
                <a href="../tutorials/writing-to-etcd.html">
            
                    
                    Writing To Etcd
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.9" >
            
                <span>
            
                    
                    Upgrades
            
                </span>
            

            
            <ul class="articles">
                
    
        <li class="chapter " data-level="1.9.1" data-path="../upgrades/_index.html">
            
                <a href="../upgrades/_index.html">
            
                    
                    Upgrading
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.2" data-path="../upgrades/upgrade_3_0.html">
            
                <a href="../upgrades/upgrade_3_0.html">
            
                    
                    Upgrade etcd from 2.3 to 3.0
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.3" data-path="../upgrades/upgrade_3_1.html">
            
                <a href="../upgrades/upgrade_3_1.html">
            
                    
                    Upgrade etcd from 3.0 to 3.1
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.4" data-path="../upgrades/upgrade_3_2.html">
            
                <a href="../upgrades/upgrade_3_2.html">
            
                    
                    Upgrade etcd from 3.1 to 3.2
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.5" data-path="../upgrades/upgrade_3_3.html">
            
                <a href="../upgrades/upgrade_3_3.html">
            
                    
                    Upgrade etcd from 3.2 to 3.3
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.6" data-path="../upgrades/upgrade_3_4.html">
            
                <a href="../upgrades/upgrade_3_4.html">
            
                    
                    Upgrade etcd from 3.3 to 3.4
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.7" data-path="../upgrades/upgrade_3_5.html">
            
                <a href="../upgrades/upgrade_3_5.html">
            
                    
                    Upgrade etcd from 3.4 to 3.5
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.9.8" data-path="../upgrades/upgrading-etcd.html">
            
                <a href="../upgrades/upgrading-etcd.html">
            
                    
                    Upgrading Etcd Clusters And Applications
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="../demo.html">
            
                <a href="../demo.html">
            
                    
                    Demo
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="../faq.html">
            
                <a href="../faq.html">
            
                    
                    FAQ
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="../install.html">
            
                <a href="../install.html">
            
                    
                    Install
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="../integrations.html">
            
                <a href="../integrations.html">
            
                    
                    Libraries And Tools
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.14" data-path="../metrics.html">
            
                <a href="../metrics.html">
            
                    
                    Metrics
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.15" data-path="../quickstart.html">
            
                <a href="../quickstart.html">
            
                    
                    Quickstart
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.16" data-path="../">
            
                <a href="../">
            
                    
                    v3.5 docs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.17" data-path="../reporting_bugs.html">
            
                <a href="../reporting_bugs.html">
            
                    
                    Reporting Bugs
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.18" data-path="../tuning.html">
            
                <a href="../tuning.html">
            
                    
                    Tuning
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href=".." >Etcd API</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <p>This document is meant to give an overview of the v3 etcd APIs central design.
This should not be mistaken with etcd v2 API, deprecated in etcd v3.5.
It is by no means all encompassing, but intended to focus on the basic ideas needed to understand etcd without the distraction of less common API calls.
All etcd APIs are defined in <a href="https://github.com/etcd-io/etcd/blob/master/api/etcdserverpb/rpc.proto" target="_blank">gRPC services</a>, which categorize remote procedure calls (RPCs) understood by the etcd server.
A full listing of all etcd RPCs are documented in markdown in the <a href="../../dev-guide/api_reference_v3">gRPC API listing</a>.</p>
<h2 id="grpc-services">gRPC Services</h2>
<p>Every API request sent to an etcd server is a gRPC remote procedure call. RPCs in etcd are categorized based on functionality into services.</p>
<p>Services important for dealing with etcd&apos;s key space include:</p>
<ul>
<li>KV - Creates, updates, fetches, and deletes key-value pairs.</li>
<li>Watch - Monitors changes to keys.</li>
<li>Lease - Primitives for consuming client keep-alive messages.</li>
</ul>
<p>Services which manage the cluster itself include:</p>
<ul>
<li>Auth - Role based authentication mechanism for authenticating users.</li>
<li>Cluster - Provides membership information and configuration facilities.</li>
<li>Maintenance - Takes recovery snapshots, defragments the store, and returns per-member status information.</li>
</ul>
<h3 id="requests-and-responses">Requests and Responses</h3>
<p>All RPCs in etcd follow the same format. Each RPC has a function <code>Name</code> which takes <code>NameRequest</code> as an argument and returns <code>NameResponse</code> as a response. For example, here is the <code>Range</code> RPC description:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">service</span> <span class="token class-name">KV</span> <span class="token punctuation">{</span>
  <span class="token function">Range</span><span class="token punctuation">(</span>RangeRequest<span class="token punctuation">)</span> returns <span class="token punctuation">(</span>RangeResponse<span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">}</span>
</code></pre>
<h3 id="response-header">Response header</h3>
<p>All Responses from etcd API have an attached response header which includes cluster metadata for the response:</p>
<pre class="language-"><code class="lang-proto">message ResponseHeader {
  uint64 cluster_id = 1;
  uint64 member_id = 2;
  int64 revision = 3;
  uint64 raft_term = 4;
}
</code></pre>
<ul>
<li>Cluster_ID - the ID of the cluster generating the response.</li>
<li>Member_ID - the ID of the member generating the response.</li>
<li>Revision - the revision of the key-value store when generating the response.</li>
<li>Raft_Term - the Raft term of the member when generating the response.</li>
</ul>
<p>An application may read the <code>Cluster_ID</code> or <code>Member_ID</code> field to ensure it is communicating with the intended cluster (member).</p>
<p>Applications can use the <code>Revision</code> field to know the latest revision of the key-value store. This is especially useful when applications specify a historical revision to make a <code>time travel query</code> and wish to know the latest revision at the time of the request.</p>
<p>Applications can use <code>Raft_Term</code> to detect when the cluster completes a new leader election.</p>
<h2 id="key-value-api">Key-Value API</h2>
<p>The Key-Value API manipulates key-value pairs stored inside etcd. The majority of requests made to etcd are usually key-value requests.</p>
<h3 id="system-primitives">System primitives</h3>
<h3 id="key-value-pair">Key-Value pair</h3>
<p>A key-value pair is the smallest unit that the key-value API can manipulate. Each key-value pair has a number of fields, defined in <a href="https://github.com/etcd-io/etcd/blob/master/api/mvccpb/kv.proto" target="_blank">protobuf format</a>:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">KeyValue</span> <span class="token punctuation">{</span>
  <span class="token builtin">bytes</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> create_revision <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> mod_revision <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> version <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token builtin">bytes</span> value <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> lease <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Key - key in bytes. An empty key is not allowed.</li>
<li>Value - value in bytes.</li>
<li>Version - version is the version of the key. A deletion resets the version to zero and any modification of the key increases its version.</li>
<li>Create_Revision - revision of the last creation on the key.</li>
<li>Mod_Revision - revision of the last modification on the key.</li>
<li>Lease - the ID of the lease attached to the key. If lease is 0, then no lease is attached to the key.</li>
</ul>
<p>In addition to just the key and value, etcd attaches additional revision metadata as part of the key message. This revision information orders keys by time of creation and modification, which is useful for managing concurrency for distributed synchronization. The etcd client&apos;s <a href="https://github.com/etcd-io/etcd/blob/master/client/v3/concurrency/mutex.go" target="_blank">distributed shared locks</a> use the creation revision to wait for lock ownership. Similarly, the modification revision is used for detecting <a href="https://github.com/etcd-io/etcd/blob/master/client/v3/concurrency/stm.go" target="_blank">software transactional memory</a> read set conflicts and waiting on <a href="https://github.com/etcd-io/etcd/blob/master/client/v3/concurrency/election.go" target="_blank">leader election</a> updates.</p>
<h4 id="revisions">Revisions</h4>
<p>etcd maintains a 64-bit cluster-wide counter, the store revision, that is incremented each time the key space is modified. The revision serves as a global logical clock, sequentially ordering all updates to the store. The change represented by a new revision is incremental; the data associated with a revision is the data that changed the store. Internally, a new revision means writing the changes to the backend&apos;s B+tree, keyed by the incremented revision.</p>
<p>Revisions become more valuable when considering etcd&apos;s <a href="https://en.wikipedia.org/wiki/Multiversion_concurrency_control" target="_blank">multi-version concurrency control</a> backend. The MVCC model means that the key-value store can be viewed from past revisions since historical key revisions are retained. The retention policy for this history can be configured by cluster administrators for fine-grained storage management; usually etcd discards old revisions of keys on a timer. A typical etcd cluster retains superseded key data for hours. This also provides reliable handling for long client disconnection, not just transient network disruptions: watchers simply resume from the last observed historical revision. Similarly, to read from the store at a particular point-in-time, read requests can be tagged with a revision to return keys from a view of the key space at the point-in-time that revision was committed.</p>
<h4 id="key-ranges">Key ranges</h4>
<p>The etcd data model indexes all keys over a flat binary key space. This differs from other key-value store systems that use a hierarchical system of organizing keys into directories. Instead of listing keys by directory, keys are listed by key intervals <code>[a, b)</code>.</p>
<p>These intervals are often referred to as &quot;ranges&quot; in etcd. Operations over ranges are more powerful than operations on directories. Like a hierarchical store, intervals support single key lookups via <code>[a, a+1)</code> (e.g., [&apos;a&apos;, &apos;a\x00&apos;) looks up &apos;a&apos;) and directory lookups by encoding keys by directory depth. In addition to those operations, intervals can also encode prefixes; for example  the interval <code>[&apos;a&apos;, &apos;b&apos;)</code> looks up all keys prefixed by the string &apos;a&apos;.</p>
<p>By convention, ranges for a request are denoted by the fields <code>key</code> and <code>range_end</code>. The <code>key</code> field is the first key of the range and should be non-empty. The <code>range_end</code> is the key following the last key of the range. If <code>range_end</code> is not given or empty, the range is defined to contain only the key argument. If <code>range_end</code> is <code>key</code> plus one (e.g., &quot;aa&quot;+1 == &quot;ab&quot;, &quot;a\xff&quot;+1 == &quot;b&quot;), then the range represents all keys prefixed with key. If both <code>key</code> and <code>range_end</code> are &apos;\0&apos;, then range represents all keys. If <code>range_end</code> is &apos;\0&apos;, the range is all keys greater than or equal to the key argument.</p>
<h3 id="range">Range</h3>
<p>Keys are fetched from the key-value store using the <code>Range</code> API call, which takes a <code>RangeRequest</code>:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">RangeRequest</span> <span class="token punctuation">{</span>
  <span class="token keyword">enum</span> <span class="token class-name">SortOrder</span> <span class="token punctuation">{</span>
    NONE <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// default, no sorting</span>
    ASCEND <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token comment">// lowest target value first</span>
    DESCEND <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span> <span class="token comment">// highest target value first</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">enum</span> <span class="token class-name">SortTarget</span> <span class="token punctuation">{</span>
    KEY <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    VERSION <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    CREATE <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    MOD <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
    VALUE <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token builtin">bytes</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">bytes</span> range_end <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> limit <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> revision <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token positional-class-name class-name">SortOrder</span> sort_order <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token positional-class-name class-name">SortTarget</span> sort_target <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
  <span class="token builtin">bool</span> serializable <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
  <span class="token builtin">bool</span> keys_only <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
  <span class="token builtin">bool</span> count_only <span class="token operator">=</span> <span class="token number">9</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> min_mod_revision <span class="token operator">=</span> <span class="token number">10</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> max_mod_revision <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> min_create_revision <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> max_create_revision <span class="token operator">=</span> <span class="token number">13</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Key, Range_End - The key range to fetch.</li>
<li>Limit - the maximum number of keys returned for the request. When limit is set to 0, it is treated as no limit.</li>
<li>Revision - the point-in-time of the key-value store to use for the range. If revision is less or equal to zero, the range is over the latest key-value store. If the revision is compacted, ErrCompacted is returned as a response.</li>
<li>Sort_Order - the ordering for sorted requests.</li>
<li>Sort_Target - the key-value field to sort.</li>
<li>Serializable - sets the range request to use serializable member-local reads. By default, Range is linearizable; it reflects the current consensus of the cluster. For better performance and availability, in exchange for possible stale reads, a serializable range request is served locally without needing to reach consensus with other nodes in the cluster.</li>
<li>Keys_Only - return only the keys and not the values.</li>
<li>Count_Only - return only the count of the keys in the range.</li>
<li>Min_Mod_Revision - the lower bound for key mod revisions; filters out lesser mod revisions.</li>
<li>Max_Mod_Revision - the upper bound for key mod revisions; filters out greater mod revisions.</li>
<li>Min_Create_Revision - the lower bound for key create revisions; filters out lesser create revisions.</li>
<li>Max_Create_Revision - the upper bound for key create revisions; filters out greater create revisions.</li>
</ul>
<p>The client receives a <code>RangeResponse</code> message from the <code>Range</code> call:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">RangeResponse</span> <span class="token punctuation">{</span>
  <span class="token positional-class-name class-name">ResponseHeader</span> header <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">mvccpb<span class="token punctuation">.</span>KeyValue</span> kvs <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token builtin">bool</span> more <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> count <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Kvs - the list of key-value pairs matched by the range request. When <code>Count_Only</code> is set, <code>Kvs</code> is empty.</li>
<li>More - indicates if there are more keys to return in the requested range if <code>limit</code> is set.</li>
<li>Count - the total number of keys satisfying the range request.</li>
</ul>
<h3 id="put">Put</h3>
<p>Keys are saved into the key-value store by issuing a <code>Put</code> call, which takes a <code>PutRequest</code>:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">PutRequest</span> <span class="token punctuation">{</span>
  <span class="token builtin">bytes</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">bytes</span> value <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> lease <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token builtin">bool</span> prev_kv <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token builtin">bool</span> ignore_value <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token builtin">bool</span> ignore_lease <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Key - the name of the key to put into the key-value store.</li>
<li>Value - the value, in bytes, to associate with the key in the key-value store.</li>
<li>Lease - the lease ID to associate with the key in the key-value store. A lease value of 0 indicates no lease.</li>
<li>Prev_Kv - when set, responds with the key-value pair data before the update from this <code>Put</code> request.</li>
<li>Ignore_Value - when set, update the key without changing its current value. Returns an error if the key does not exist.</li>
<li>Ignore_Lease - when set, update the key without changing its current lease. Returns an error if the key does not exist.</li>
</ul>
<p>The client receives a <code>PutResponse</code> message from the <code>Put</code> call:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">PutResponse</span> <span class="token punctuation">{</span>
  <span class="token positional-class-name class-name">ResponseHeader</span> header <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token positional-class-name class-name">mvccpb<span class="token punctuation">.</span>KeyValue</span> prev_kv <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Prev_Kv - the key-value pair overwritten by the <code>Put</code>, if <code>Prev_Kv</code> was set in the <code>PutRequest</code>.</li>
</ul>
<h3 id="delete-range">Delete Range</h3>
<p>Ranges of keys are deleted using the <code>DeleteRange</code> call, which takes a <code>DeleteRangeRequest</code>:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">DeleteRangeRequest</span> <span class="token punctuation">{</span>
  <span class="token builtin">bytes</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">bytes</span> range_end <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token builtin">bool</span> prev_kv <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Key, Range_End - The key range to delete.</li>
<li>Prev_Kv - when set, return the contents of the deleted key-value pairs.</li>
</ul>
<p>The client receives a <code>DeleteRangeResponse</code> message from the <code>DeleteRange</code> call:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">DeleteRangeResponse</span> <span class="token punctuation">{</span>
  <span class="token positional-class-name class-name">ResponseHeader</span> header <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> deleted <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">mvccpb<span class="token punctuation">.</span>KeyValue</span> prev_kvs <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Deleted - number of keys deleted.</li>
<li>Prev_Kv - a list of all key-value pairs deleted by the <code>DeleteRange</code> operation.</li>
</ul>
<h3 id="transaction">Transaction</h3>
<p>A transaction is an atomic If/Then/Else construct over the key-value store. It provides a primitive for grouping requests together in atomic blocks (i.e., then/else) whose execution is guarded (i.e., if) based on the contents of the key-value store. Transactions can be used for protecting keys from unintended concurrent updates, building compare-and-swap operations, and developing higher-level concurrency control.</p>
<p>A transaction can atomically process multiple requests in a single request. For modifications to the key-value store, this means the store&apos;s revision is incremented only once for the transaction and all events generated by the transaction will have the same revision. However, modifications to the same key multiple times within a single transaction are forbidden.</p>
<p>All transactions are guarded by a conjunction of comparisons, similar to an <code>If</code> statement. Each comparison checks a single key in the store. It may check for the absence or presence of a value, compare with a given value, or check a key&apos;s revision or version. Two different comparisons may apply to the same or different keys. All comparisons are applied atomically; if all comparisons are true, the transaction is said to succeed and etcd applies the transaction&apos;s then / <code>success</code> request block, otherwise it is said to fail and applies the else / <code>failure</code> request block.</p>
<p>Each comparison is encoded as a <code>Compare</code> message:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">Compare</span> <span class="token punctuation">{</span>
  <span class="token keyword">enum</span> <span class="token class-name">CompareResult</span> <span class="token punctuation">{</span>
    EQUAL <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    GREATER <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    LESS <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    NOT_EQUAL <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">enum</span> <span class="token class-name">CompareTarget</span> <span class="token punctuation">{</span>
    VERSION <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    CREATE <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    MOD <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    VALUE<span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token positional-class-name class-name">CompareResult</span> result <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token comment">// target is the key-value field to inspect for the comparison.</span>
  <span class="token positional-class-name class-name">CompareTarget</span> target <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token comment">// key is the subject key for the comparison operation.</span>
  <span class="token builtin">bytes</span> key <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token keyword">oneof</span> target_union <span class="token punctuation">{</span>
    <span class="token builtin">int64</span> version <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token builtin">int64</span> create_revision <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
    <span class="token builtin">int64</span> mod_revision <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
    <span class="token builtin">bytes</span> value <span class="token operator">=</span> <span class="token number">7</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Result - the kind of logical comparison operation (e.g., equal, less than, etc).</li>
<li>Target - the key-value field to be compared. Either the key&apos;s version, create revision, modification revision, or value.</li>
<li>Key - the key for the comparison.</li>
<li>Target_Union - the user-specified data for the comparison.</li>
</ul>
<p>After processing the comparison block, the transaction applies a block of requests. A block is a list of <code>RequestOp</code> messages:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">RequestOp</span> <span class="token punctuation">{</span>
  <span class="token comment">// request is a union of request types accepted by a transaction.</span>
  <span class="token keyword">oneof</span> request <span class="token punctuation">{</span>
    <span class="token positional-class-name class-name">RangeRequest</span> request_range <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token positional-class-name class-name">PutRequest</span> request_put <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token positional-class-name class-name">DeleteRangeRequest</span> request_delete_range <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Request_Range - a <code>RangeRequest</code>.</li>
<li>Request_Put - a <code>PutRequest</code>. The keys must be unique. It may not share keys with any other Puts or Deletes.</li>
<li>Request_Delete_Range - a <code>DeleteRangeRequest</code>. It may not share keys with any Puts or Deletes requests.</li>
</ul>
<p>All together, a transaction is issued with a <code>Txn</code> API call, which takes a <code>TxnRequest</code>:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">TxnRequest</span> <span class="token punctuation">{</span>
  <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">Compare</span> compare <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">RequestOp</span> success <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">RequestOp</span> failure <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Compare - A list of predicates representing a conjunction of terms for guarding the transaction.</li>
<li>Success - A list of requests to process if all compare tests evaluate to true.</li>
<li>Failure - A list of requests to process if any compare test evaluates to false.</li>
</ul>
<p>The client receives a <code>TxnResponse</code> message from the <code>Txn</code> call:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">TxnResponse</span> <span class="token punctuation">{</span>
  <span class="token positional-class-name class-name">ResponseHeader</span> header <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">bool</span> succeeded <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">ResponseOp</span> responses <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Succeeded - Whether <code>Compare</code> evaluated to true or false.</li>
<li>Responses - A list of responses corresponding to the results from applying the <code>Success</code> block if succeeded is true or the <code>Failure</code> if succeeded is false.</li>
</ul>
<p>The <code>Responses</code> list corresponds to the results from the applied <code>RequestOp</code> list, with each response encoded as a <code>ResponseOp</code>:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">ResponseOp</span> <span class="token punctuation">{</span>
  <span class="token keyword">oneof</span> response <span class="token punctuation">{</span>
    <span class="token positional-class-name class-name">RangeResponse</span> response_range <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    <span class="token positional-class-name class-name">PutResponse</span> response_put <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
    <span class="token positional-class-name class-name">DeleteRangeResponse</span> response_delete_range <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>The <code>ResponseHeader</code> included in each inner response shouldn&apos;t be interpreted in any way.
If clients need to get the latest revision, then they should always check the top level <code>ResponseHeader</code> in <code>TxnResponse</code>.</p>
<h2 id="watch-api">Watch API</h2>
<p>The <code>Watch</code> API provides an event-based interface for asynchronously monitoring changes to keys. An etcd watch waits for changes to keys by continuously watching from a given revision, either current or historical, and streams key updates back to the client.</p>
<h3 id="events">Events</h3>
<p>Every change to every key is represented with <code>Event</code> messages. An <code>Event</code> message provides both the update&apos;s data and the type of update:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">Event</span> <span class="token punctuation">{</span>
  <span class="token keyword">enum</span> <span class="token class-name">EventType</span> <span class="token punctuation">{</span>
    PUT <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    DELETE <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token positional-class-name class-name">EventType</span> type <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token positional-class-name class-name">KeyValue</span> kv <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token positional-class-name class-name">KeyValue</span> prev_kv <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Type - The kind of event. A PUT type indicates new data has been stored to the key. A DELETE indicates the key was deleted.</li>
<li>KV - The KeyValue associated with the event. A PUT event contains current kv pair. A PUT event with kv.Version=1 indicates the creation of a key. A DELETE event contains the deleted key with its modification revision set to the revision of deletion.</li>
<li>Prev_KV - The key-value pair for the key from the revision immediately before the event. To save bandwidth, it is only filled out if the watch has explicitly enabled it.</li>
</ul>
<h3 id="watch-streams">Watch streams</h3>
<p>Watches are long-running requests and use gRPC streams to stream event data. A watch stream is bi-directional; the client writes to the stream to establish watches and reads to receive watch events. A single watch stream can multiplex many distinct watches by tagging events with per-watch identifiers. This multiplexing helps reducing the memory footprint and connection overhead on the core etcd cluster.</p>
<p>To read about guarantees made about watch events, please read <a href="../api_guarantees#watch-apis">etcd api guarantees</a>.</p>
<p>A client creates a watch by sending a <code>WatchCreateRequest</code> over a stream returned by <code>Watch</code>:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">WatchCreateRequest</span> <span class="token punctuation">{</span>
  <span class="token builtin">bytes</span> key <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">bytes</span> range_end <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> start_revision <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token builtin">bool</span> progress_notify <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>

  <span class="token keyword">enum</span> <span class="token class-name">FilterType</span> <span class="token punctuation">{</span>
    NOPUT <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    NODELETE <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">FilterType</span> filters <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>
  <span class="token builtin">bool</span> prev_kv <span class="token operator">=</span> <span class="token number">6</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Key, Range_End - The key range to watch.</li>
<li>Start_Revision - An optional revision for where to inclusively begin watching. If not given, it will stream events following the revision of the watch creation response header revision. The entire available event history can be watched starting from the last compaction revision.</li>
<li>Progress_Notify - When set, the watch will periodically receive a WatchResponse with no events, if there are no recent events. It is useful when clients wish to recover a disconnected watcher starting from a recent known revision. The etcd server decides how often to send notifications based on current server load.</li>
<li>Filters - A list of event types to filter away at server side.</li>
<li>Prev_Kv - When set, the watch receives the key-value data from before the event happens. This is useful for knowing what data has been overwritten.</li>
</ul>
<p>In response to a <code>WatchCreateRequest</code> or if there is a new event for some established watch, the client receives a <code>WatchResponse</code>:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">WatchResponse</span> <span class="token punctuation">{</span>
  <span class="token positional-class-name class-name">ResponseHeader</span> header <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> watch_id <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token builtin">bool</span> created <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
  <span class="token builtin">bool</span> canceled <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> compact_revision <span class="token operator">=</span> <span class="token number">5</span><span class="token punctuation">;</span>

  <span class="token keyword">repeated</span> <span class="token positional-class-name class-name">mvccpb<span class="token punctuation">.</span>Event</span> events <span class="token operator">=</span> <span class="token number">11</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Watch_ID - the ID of the watch that corresponds to the response.</li>
<li>Created - set to true if the response is for a create watch request. The client should store the ID and expect to receive events for the watch on the stream. All events sent to the created watcher will have the same watch_id.</li>
<li>Canceled - set to true if the response is for a cancel watch request. No further events will be sent to the canceled watcher.</li>
<li>Compact_Revision - set to the minimum historical revision available to etcd if a watcher tries watching at a compacted revision. This happens when creating a watcher at a compacted revision or the watcher cannot catch up with the progress of the key-value store. The watcher will be canceled; creating new watches with the same start_revision will fail.</li>
<li>Events - a list of new events in sequence corresponding to the given watch ID.</li>
</ul>
<p>If the client wishes to stop receiving events for a watch, it issues a <code>WatchCancelRequest</code>:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">WatchCancelRequest</span> <span class="token punctuation">{</span>
   <span class="token builtin">int64</span> watch_id <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>Watch_ID - the ID of the watch to cancel so that no more events are transmitted.</li>
</ul>
<h2 id="lease-api">Lease API</h2>
<p>Leases are a mechanism for detecting client liveness. The cluster grants leases with a time-to-live. A lease expires if the etcd cluster does not receive a keepAlive within a given TTL period.</p>
<p>To tie leases into the key-value store, each key may be attached to at most one lease. When a lease expires or is revoked, all keys attached to that lease will be deleted. Each expired key generates a delete event in the event history.</p>
<h3 id="obtaining-leases">Obtaining leases</h3>
<p>Leases are obtained through the <code>LeaseGrant</code> API call, which takes a <code>LeaseGrantRequest</code>:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">LeaseGrantRequest</span> <span class="token punctuation">{</span>
  <span class="token builtin">int64</span> TTL <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> ID <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>TTL - the advisory time-to-live, in seconds.</li>
<li>ID - the requested ID for the lease. If ID is set to 0, etcd will choose an ID.</li>
</ul>
<p>The client receives a <code>LeaseGrantResponse</code> from the <code>LeaseGrant</code> call:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">LeaseGrantResponse</span> <span class="token punctuation">{</span>
  <span class="token positional-class-name class-name">ResponseHeader</span> header <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> ID <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> TTL <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>ID - the lease ID for the granted lease.</li>
<li>TTL - is the server selected time-to-live, in seconds, for the lease.</li>
</ul>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">LeaseRevokeRequest</span> <span class="token punctuation">{</span>
  <span class="token builtin">int64</span> ID <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>ID - the lease ID to revoke. When the lease is revoked, all attached keys are deleted.</li>
</ul>
<h3 id="keep-alives">Keep alives</h3>
<p>Leases are refreshed using a bi-directional stream created with the <code>LeaseKeepAlive</code> API call. When the client wishes to refresh a lease, it sends a <code>LeaseKeepAliveRequest</code> over the stream:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">LeaseKeepAliveRequest</span> <span class="token punctuation">{</span>
  <span class="token builtin">int64</span> ID <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>ID - the lease ID for the lease to keep alive.</li>
</ul>
<p>The keep alive stream responds with a <code>LeaseKeepAliveResponse</code>:</p>
<pre class="language-"><code class="lang-protobuf"><span class="token keyword">message</span> <span class="token class-name">LeaseKeepAliveResponse</span> <span class="token punctuation">{</span>
  <span class="token positional-class-name class-name">ResponseHeader</span> header <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> ID <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>
  <span class="token builtin">int64</span> TTL <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre>
<ul>
<li>ID - the lease that was refreshed with a new TTL.</li>
<li>TTL - the new time-to-live, in seconds, that the lease has remaining.</li>
</ul>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="api_guarantees.html" class="navigation navigation-prev " aria-label="Previous page: Etcd API Guarantees">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="data_model.html" class="navigation navigation-next " aria-label="Next page: Data Model">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Etcd API","weight":2625,"description":"etcd API central design overview","level":"1.5.3","depth":2,"next":{"title":"Data Model","level":"1.5.4","depth":2,"path":"learning/data_model.md","ref":"learning/data_model.md","articles":[]},"previous":{"title":"Etcd API Guarantees","level":"1.5.2","depth":2,"path":"learning/api_guarantees.md","ref":"learning/api_guarantees.md","articles":[]},"dir":"ltr"},"config":{"plugins":["-sharing","-highlight","-livereload","prism"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{"css":["prismjs/themes/prism-solarizedlight.css"]},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"etcd 英文文档","language":"us-en","links":{"sidebar":{"Home":"https://docs.khs1994.com"}},"gitbook":"*"},"file":{"path":"learning/api.md","mtime":"2024-09-13T01:00:24.000Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2024-09-13T01:01:05.458Z"},"basePath":"..","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="../gitbook/gitbook.js"></script>
    <script src="../gitbook/theme.js"></script>
    
        
        <script src="../gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="../gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

